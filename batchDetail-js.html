<script> // this tag is removed when the page is loaded
 
 // Page load
$(function() {
 
 $('.selectpicker').selectpicker('render'); // There's an unknown issue with the select statement loading, and this fixes it

    memory_.loadedRecordSheetTableName = 'batch';
    var id = memory_.loadedRecordId;
    if (id) {
   //   getPageData_('batch',id);
      $('#batchHeader3').append(' #'+id);
    }
      
     
     createEventHandlers(); 
 })
  
  /*------------------------------------------------------------------------------------*/
  /*********************************** EVENT HANDLERS ***********************************/
  /*------------------------------------------------------------------------------------*/
  
  
  var createEventHandlers = function () {
  
    // New Batch button event
    $('#createNewBatchBtn').click(function(){
      $('#batchHeader3').html('BATCH');
      createNewPageRecord({sheetName:'batch',headerId:'batchHeader3'},'batch');
    });
    
    // Back to batches list
    $('#backToBatchesBtn').click(function(){
      getPage('batchList');
    });
   
   // Unhide the "starter details section"
    $('#showStarterDetails').click(function(){
       if($(this).is(":checked")){
         $('#starterDetails').show();
       } else {
         $('#starterDetails').hide();
       }
    })
    
    $('#recipeId').click(function(){
      const recipeId = $(this).html();
      if (recipeId.indexOf('Recipe') > -1) return;
      getPage( pageToLoad(recipeId) ,recipeId);
    });
    
    // Save the ferment modal values
    $('#saveFermentDetails').click(function(){
      
      var output = {};
      $('[data-ferment-modal-id]').each(function () {
            var modalElem = $(this);
            var elemId = modalElem.attr('data-ferment-modal-id');
            
            output[elemId] = modalElem.val();
            
        });
        
      // Update UI table
      const fermentTableDetails = memory_.fermentTableHelper;
      $('#'+fermentTableDetails.id).bootstrapTable('updateRow', {
        index: fermentTableDetails.index,
        row: output
      })
      
      output.sheetName = 'ferment_details'; // The sheet to save to
      
      // Update database table
      updateDatabase_(output,'update');
    });
    
    
    $('#test').click(function(){
    
    
//    const steps = ['1', '2', '3']
//const swalQueueStep = Swal.mixin({
//  confirmButtonText: 'Forward',
//  cancelButtonText: 'Back',
//  progressSteps: steps,
//  input: 'text',
//  inputAttributes: {
//    required: true
//  },
//  reverseButtons: true,
//  validationMessage: 'This field is required'
//})
//
//async function backAndForth () {
//  const values = []
//  let currentStep
//
//  for (currentStep = 0; currentStep < steps.length;) {
//    const result = await swalQueueStep.fire({
//      title: 'Question ' + steps[currentStep],
//      inputValue: values[currentStep],
//      showCancelButton: currentStep > 0,
//      currentProgressStep: currentStep
//    })
//
//    if (result.value) {
//      values[currentStep] = result.value
//      currentStep++
//    } else if (result.dismiss === 'cancel') {
//      currentStep--
//    } else {
//      break
//    }
//  }
//
//  if (currentStep === steps.length) {
//    Swal.fire(JSON.stringify(values))
//  }
//}
//
//backAndForth()
//return;
    
// Select if you want to load a recipe or create a new one
// If load a recipe
// - show a select option with all the recipe ids with the description
// - get the recipe data from the database then load the data
// If new recipe
// - Get the type (mead, cider, etc)
// - Brief description (basic ingredients)
// - Create new row in database and input the new recipe id
// - default recipe status is "concept"
      Swal.fire({
        title: 'Recipe',
        input: 'radio',
        inputOptions: {
            'load': 'Load',
            'new': 'Create New'
          },
        inputValidator: (value) => {
          if (!value) {
            return 'Make a selection'
          }
        }
      }).then((result) => {
      console.log(JSON.stringify(result));
      
        if (result.value == 'load') {
          // Show drop down list with recipes
        } else if (result.value == 'new') {
          // Ask questions to create new recipe
        } else if (result.isDismissed) {
          // Let user know they need to make a selection or do something else
        }
      //  
      //    Swal.fire(
      //      'Deleted!',
      //      'Your file has been deleted.',
      //      'success'
      //    )
      //  }
      })

     // loadABatch();
    });
    
    
    // Handles saving tables values
    createNewTableRowEventTrigger();
    // Handles saving input values
    createOnChangeTrigger();
  }
  
 
  /*-------------------------------------------------------------------------------------*/
  /***********************************    FUNCTIONS    ***********************************/
  /*-------------------------------------------------------------------------------------*/

var loadABatch = function() {
      Swal.mixin({
        input: 'text',
        confirmButtonText: 'Next &rarr;',
        showCancelButton: true,
        progressSteps: ['1', '2', '3']
      }).queue([
        {
          title: 'Question 1',
          text: 'Chaining swal2 modals is easy',
          input: 'select',
          inputOptions: {
            'Fruits': {
              apples: 'Apples',
              bananas: 'Bananas',
              grapes: 'Grapes',
              oranges: 'Oranges'
            }},
          inputPlaceholder: 'Select a fruit',
        },
        'Question 2',
        'Question 3'
      ]).then((result) => {
        if (result.value) {
          const answers = JSON.stringify(result.value);
          //do something
          Swal.fire({
            title: 'All done!',
            html: `
              Your answers:
              <pre><code>${answers}</code></pre>
            `,
            confirmButtonText: 'Lovely!'
          });
          
        }
      })
    };
